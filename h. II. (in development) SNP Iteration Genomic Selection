#==================================================
#Preparation of grm files in bash linux
#==================================================

# Set variables
bed_file="your_genotype_data.bed"
bim_file="your_genotype_data.bim"
fam_file="your_genotype_data.fam"
gwas_file="sorted_gwas.txt"
output_prefix="final"

# Loop through and create subsets
for i in $(seq 1 100 $(wc -l < sorted_gwas.txt)); do
  # Create a list of SNPs (100 at a time)
  end=$((i + 99))
  awk "NR>=$i && NR<=$end {print \$1}" sorted_gwas.txt > snp_subset.txt
  
  # Create a bed file with the SNPs
  plink --bfile $bed_file --extract snp_subset.txt --make-bed --out ${output_prefix}_subset_$((i/100+1))
  
  # Generate GRM
  plink --bfile ${output_prefix}_subset_$((i/100+1)) --make-rel --out ${output_prefix}_grm_$((i/100+1))
done

#==================================================
#Genomic selection in R
#==================================================
# Load libraries
library(data.table)
library(BGLR)

# Set directory where GRM files are stored
grm_dir <- "path/to/grm_files"
grm_files <- list.files(grm_dir, pattern = "*grm.*.rel", full.names = TRUE)

# Loop through each GRM file
for (grm_file in grm_files) {
  G <- as.matrix(fread(grm_file))
  
  # Proceed with your genomic selection analysis using G
  # Fit the model
  fm <- BGLR(yNA, ETA = list(list(K = G, model = "RKHS")), nIter = nIter, burnIn = burnIn)
  
  # Calculate correlation accuracy, etc.
}
