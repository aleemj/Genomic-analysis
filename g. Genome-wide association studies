#GWAS using GEMMA https://github.com/genetics-statistics/GEMMA.git
#conda install gemma #to install GEMMA using conda package manager, ensure conda is available first
#input genotype file must be in plink .bed format
#input phenotype is in the .fam file under the 6th column, 2nd column is the individual ids - recognises "-9" or "NA" as missing phenotype, "0" / "1" can be used for case/control GWAS.
#for multiple phenotypes, add in .fam file columns from 6th column onwards ("-n 1": 6th column, "-n 2": 7th column and so on).

#1. Association Tests with a Linear Model
gemma -bfile $input -lm 3 -o $output

#2. Estimate relatedness matrix
gemma -bfile $input -gk 1 -o $output 

#3. Eigen-decomposition of relatedness matrix
gemma -bfile $input -k $relatedness_matrix -eigen -o $output

#4. Association Tests with Univariate Linear Mixed Models
gemma -bfile $input -k $relatedness_matrix -c $covariate(optional) -lmm 3 -o $output

#5. Association Tests with Multivariate Linear Mixed Models
gemma -bfile $input -k $relatedness_matrix -c $covariate(optional) -lmm 3 -n 1 -o $output

#6. Fit a Bayesian Sparse Linear Mixed Model
gemma -bfile $input  -bslmm [num] -o $output

#Notes:
#where "lm [num]" specifies which test to use: “-lm 1” performs Wald test, “-lm 2” performs likelihood ratio test, “-lm 3” performs score test, and “-lm 4” performs all the three tests.
#where "gk [num]" specifies which matrix to calculate: “-gk 1” calculates the centered relatedness matrix while “-gk 2” calculates the standardized relatedness matrix.
#where “-k [filename]” could be replaced by “-d [filename]” and “-u [filename]”, where “- d [filename]” specifies the eigen value file and “-u [filename]” specifies the eigen vector file.
#where "-n [num]" specifies the columns to use as the phenotypes, where multiple phenotypes are present one can use "-n [num1] [num2] [num3]", keep to less than 10 phenotypes
#where “-bslmm [num]” option specifies which model to fit, i.e. “-bslmm 1” fits a stan- dard linear BSLMM, “-bslmm 2” fits a ridge regression/GBLUP, and “-bslmm 3” fits a probit BSLMM

#Errors:
#ERROR: Enforce failed for number of analyzed individuals equals 0. in src/param.cpp at line 2073 in ProcessCvtPhen
#Solution: ensure .fam file has phenotype column filled in - "-9" or "NA" will result in this error.
